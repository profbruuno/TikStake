<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>TikStake</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <!-- Navigation bar -->
  <nav>
    <a href="#landing">Home</a>
    <a href="#choose-assets">Choose Assets</a>
    <a href="#exchanges">Exchanges</a>
    <a href="#user-area">User Area</a>
  </nav>

  <!-- Landing Section -->
  <section id="landing">
    <h1>Welcome to TikStake</h1>
    <p>Your one-stop platform for managing and tracking your asset portfolio.</p>
  </section>

  <!-- Asset Selection Section -->
  <section id="choose-assets">
    <h2>Choose Your Assets</h2>
    <!-- Asset selection UI goes here -->
  </section>

  <!-- Exchanges Section -->
  <section id="exchanges">
    <h2>Connect with Exchanges</h2>
    <!-- Exchange connection UI goes here -->
  </section>

  <!-- User Area Section -->
  <section id="user-area">
    <h2>User Area</h2>

    <!-- Email/Password Auth Form -->
    <form id="email-form">
      <input type="email" id="email" placeholder="Email" required />
      <input type="password" id="password" placeholder="Password" required />
      <button type="submit">Sign In / Register with Email</button>
    </form>

    <!-- Phone Auth Form -->
    <form id="phone-form">
      <input type="tel" id="phone-number" placeholder="Phone number (+1234567890)" required />
      <div id="recaptcha-container"></div>
      <button type="submit">Send Verification Code</button>
      <input type="text" id="verification-code" placeholder="Verification code" style="display:none;" />
      <button type="button" id="verify-code" style="display:none;">Verify Code</button>
    </form>

    <!-- GitHub Auth -->
    <button id="github-login">Sign in with GitHub</button>
    <button id="logout" style="display:none;">Logout</button>
    <div id="user-info"></div>
    <p style="font-size: small; color: #888; margin-top: 1em;">
      Authentication options enabled (<b>see image 1</b>): Email/Password, Phone, and GitHub.
    </p>
  </section>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
    import {
      getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword,
      signInWithPopup, GithubAuthProvider, signOut, onAuthStateChanged,
      signInWithPhoneNumber, RecaptchaVerifier
    } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyC5w0_QVUfdgqyWFmBbkjpYlKTVL3FqjFA",
      authDomain: "tikstake-1d012.firebaseapp.com",
      projectId: "tikstake-1d012",
      storageBucket: "tikstake-1d012.appspot.com",
      messagingSenderId: "294492488230",
      appId: "1:294492488230:web:22ef9a3184d10469309ce7",
      measurementId: "G-941Y8614DD"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const provider = new GithubAuthProvider();

    // Email/Password logic
    document.getElementById('email-form').onsubmit = async (e) => {
      e.preventDefault();
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      try {
        await signInWithEmailAndPassword(auth, email, password);
      } catch (error) {
        if (error.code === 'auth/user-not-found') {
          try {
            await createUserWithEmailAndPassword(auth, email, password);
          } catch (err) {
            alert(err.message);
          }
        } else {
          alert(error.message);
        }
      }
    };

    // GitHub logic
    document.getElementById("github-login").onclick = function() {
      signInWithPopup(auth, provider).catch((error) => alert(error.message));
    };

    // Phone logic
    let confirmationResult = null;
    let recaptchaRendered = false;
    function renderRecaptcha() {
      if (!recaptchaRendered) {
        window.recaptchaVerifier = new RecaptchaVerifier('recaptcha-container', {
          'size': 'invisible'
        }, auth);
        recaptchaRendered = true;
      }
    }

    document.getElementById('phone-form').onsubmit = async (e) => {
      e.preventDefault();
      renderRecaptcha();
      const phoneNumber = document.getElementById('phone-number').value;
      try {
        confirmationResult = await signInWithPhoneNumber(auth, phoneNumber, window.recaptchaVerifier);
        document.getElementById('verification-code').style.display = '';
        document.getElementById('verify-code').style.display = '';
        alert('SMS sent!');
      } catch (error) {
        alert(error.message);
      }
    };

    document.getElementById('verify-code').onclick = async () => {
      const code = document.getElementById('verification-code').value;
      try {
        await confirmationResult.confirm(code);
      } catch (error) {
        alert(error.message);
      }
    };

    // Logout
    document.getElementById("logout").onclick = function() {
      signOut(auth);
    };

    // UI state
    onAuthStateChanged(auth, (user) => {
      const isLoggedIn = !!user;
      document.getElementById("email-form").style.display = isLoggedIn ? "none" : "";
      document.getElementById("github-login").style.display = isLoggedIn ? "none" : "";
      document.getElementById("phone-form").style.display = isLoggedIn ? "none" : "";
      document.getElementById("logout").style.display = isLoggedIn ? "" : "none";
      document.getElementById("user-info").textContent = isLoggedIn
        ? `Logged in as: ${user.phoneNumber || user.email || user.displayName}`
        : "";
    });
  </script>
</body>
</html>
