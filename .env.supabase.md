# Supabase Configuration for TikStake

## Environment Setup

This project is integrated with Supabase for storing user lock data. The configuration is currently hardcoded in `supabase.js`.

### Current Configuration

- **Supabase URL**: `https://lxslwibjxarfbshleiyd.supabase.co`
- **Public Anon Key**: `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlhdCI6MTY4ODIyNzA2NCwiZXhwIjo0MDA0Mzg0NjQ0fQ.EJ5lq6nKq3SIR1X8R4mV2Trt2a0zCn3fH8u3xEwF0eI`

## Database Schema

The application expects a `locks` table with the following structure:

```sql
CREATE TABLE locks (
  id BIGSERIAL PRIMARY KEY,
  user_id TEXT NOT NULL,
  crypto TEXT NOT NULL,
  icon TEXT NOT NULL,
  amount NUMERIC NOT NULL,
  duration TEXT NOT NULL,
  start TEXT NOT NULL,
  end TEXT NOT NULL,
  gain NUMERIC DEFAULT 0,
  loss NUMERIC DEFAULT 0,
  withdrawal TEXT DEFAULT 'Locked',
  timesLocked INTEGER DEFAULT 1,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

## Row Level Security (RLS)

⚠️ **IMPORTANT SECURITY NOTE**: This demo uses the public anon key for all operations. In a production environment, you should:

1. Enable Row Level Security (RLS) on the `locks` table
2. Implement proper authentication (Supabase Auth)
3. Create RLS policies to ensure users can only access their own locks
4. Use environment variables to store sensitive keys
5. Never expose the service role key in client-side code

### Recommended RLS Policies

```sql
-- Enable RLS
ALTER TABLE locks ENABLE ROW LEVEL SECURITY;

-- Policy for users to see only their own locks
CREATE POLICY "Users can view own locks" ON locks
  FOR SELECT USING (auth.uid()::text = user_id);

-- Policy for users to insert their own locks
CREATE POLICY "Users can insert own locks" ON locks
  FOR INSERT WITH CHECK (auth.uid()::text = user_id);

-- Policy for users to update their own locks
CREATE POLICY "Users can update own locks" ON locks
  FOR UPDATE USING (auth.uid()::text = user_id);

-- Policy for users to delete their own locks
CREATE POLICY "Users can delete own locks" ON locks
  FOR DELETE USING (auth.uid()::text = user_id);
```

## Environment Variables (Recommended for Production)

Create a `.env` file (never commit this):

```env
SUPABASE_URL=your_supabase_project_url
SUPABASE_ANON_KEY=your_supabase_anon_key
```

Then update `supabase.js` to use these variables:

```javascript
const SUPABASE_URL = process.env.SUPABASE_URL || 'your_fallback_url';
const SUPABASE_ANON_KEY = process.env.SUPABASE_ANON_KEY || 'your_fallback_key';
```

## Security Considerations

1. **Public Anon Key**: The anon key is safe to expose in client-side code, but ensure RLS policies are properly configured
2. **Service Role Key**: NEVER expose the service role key in client-side code
3. **Authentication**: Consider implementing Supabase Auth for better user management
4. **Data Validation**: Implement proper data validation both client-side and database-side
5. **Rate Limiting**: Configure rate limiting in Supabase dashboard to prevent abuse

## Testing the Integration

1. Ensure the Supabase project is running and accessible
2. Verify the `locks` table exists with the correct schema
3. Test user login and check that locks are fetched from Supabase
4. Monitor the browser console for any connection errors

## Troubleshooting

- **CORS Issues**: Ensure your domain is added to the allowed origins in Supabase settings
- **Connection Errors**: Verify the Supabase URL and anon key are correct
- **Database Errors**: Check that the `locks` table exists and has the expected columns
- **RLS Issues**: If using RLS, ensure policies are correctly configured for your authentication setup